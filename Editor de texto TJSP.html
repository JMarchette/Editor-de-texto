<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://cdn.quilljs.com;
        style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.quilljs.com;
        font-src 'self' https://cdnjs.cloudflare.com;
        img-src 'self' data: https://cdn.quilljs.com;
        connect-src 'self';
        frame-src 'self';
    ">
    <title>Editor de texto</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">   
    <style>
        #toolbar {
            margin-bottom: 10px;
            border-bottom: 1px solid #ddd;
            background: #f8f9fa;
            padding: 5px;
            display: flex;
            flex-wrap: wrap;
        }
        #toolbar .ql-formats {
            margin-right: 5px;
        }
        .ql-toolbar.ql-snow {
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .ql-container.ql-snow {
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .check-icon {
            display: none;
            color: green;
            margin-left: 5px;
        }
        .button-container {
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="toolbar">
            <div class="button-container">
                <button class="botaoNegrito" title="Negrito"><i class="fas fa-bold"></i></button>
            </div>
            <div class="button-container">
                <button class="botaoItalico" title="Itálico"><i class="fas fa-italic"></i></button>
            </div>
            <div class="button-container">
                <button class="botaoSublinhar" title="Sublinhado"><i class="fas fa-underline"></i></button>
            </div>
            <div class="button-container">
                <button class="botaoCopiar" title="Copiar"><i class="fas fa-copy"></i></button>
            </div>
            <div class="button-container">
                <button class="botaoColar" title="Colar"><i class="fas fa-paste"></i></button>
            </div>
            <div class="button-container">
                <button class="botaoApagar" title="Apagar"><i class="fas fa-trash"></i></button>
            </div>
            <div class="button-container">
                <button class="botaoEnviar" title="Enviar"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <div id="editor" style="height: 400px;"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.6/quill.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.3.7/purify.min.js"></script>
    <script>
        var quill = new Quill('#editor', {
            modules: {
                toolbar: '#toolbar'
            },
            theme: 'snow'
        });

        // função para proteger contra possíveis entradas XSS
        function sanitizeContent(content) {
            return DOMPurify.sanitize(content);
        }

        function confirmaClique(button, iconClass) {
            var icon = button.querySelector('i');
            if (icon) {
                var originalClass = icon.className;
                icon.className = iconClass;
                setTimeout(function() {
                    icon.className = originalClass;
                }, 3000); // Exibe o ícone de confirmação por 3 segundos
            }
        }

        document.querySelector('.botaoCopiar').addEventListener('click', function() {
            var texto = quill.getText();
            navigator.clipboard.writeText(texto).then(function() {
                confirmaClique(document.querySelector('.botaoCopiar'), 'fas fa-check');
                //alert('Copiado com sucesso.');
            }).catch(function() {
                alert('Falha ao copiar o texto.');
            });
        });

        document.querySelector('.botaoColar').addEventListener('click', function() {
            navigator.clipboard.readText().then(function(texto) {
                var tamTexto = quill.getSelection();
                if (tamTexto) {
                    quill.insertText(tamTexto.index, texto);
                    confirmaClique(document.querySelector('.botaoColar'), 'fas fa-check');
                    //alert('Colado com sucesso.');
                }
            }).catch(function() {
                alert('Falha ao colar o texto.');
            });
        });

        document.querySelector('.botaoApagar').addEventListener('click', function() {
            quill.setText("");
            confirmaClique(document.querySelector('.botaoApagar'), 'fas fa-check');
            //alert('Apagado com sucesso.');
        });

        document.querySelector('.botaoEnviar').addEventListener('click', function() {
            var conteudoHtml = quill.root.innerHTML;
            var textoSeguro = sanitizeContent(conteudoHtml);
            console.log(textoSeguro); // Substitua por chamada para enviar os dados
            confirmaClique(document.querySelector('.botaoEnviar'), 'fas fa-check');
            //alert('Enviado com sucesso.');
        });

    </script>
</body>
</html>
